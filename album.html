<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
	<link rel="icon" href="img/favicon.ico">
    <title>专辑</title>
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="css/main.css" rel="stylesheet"/>
  </head>
  <body>
	  
	<div class="mod_header">
	    <div class="section_inner">
	        <h1 class="qqmusic_title"><a href="index.html"><img src="img/musiclogo.png" alt="牟云音乐" class="music_logo"></a></h1>
	        <!-- 导航 S -->
	        <ul class="mod_top_nav" role="nav">
	            <li class="top_nav__item">
	                <a href="index.html" class="top_nav__link top_nav__link--current" title="音乐馆">音乐馆</a>
	            </li>
	            <li class="top_nav__item">
	                <a href="playlists.html" class="top_nav__link" title="歌单">歌单</a>
	            </li>
				<li class="top_nav__item">
				    <a href="index.html#ranking" class="top_nav__link" title="排行榜">排行榜</a>
				</li>
				<li class="top_nav__item">
				    <a href="singers.html" class="top_nav__link" title="歌手">歌手</a>
				</li>
	        </ul>
		</div>
	</div>
	<!-- 加载动画 -->
	<div class='miaov_head' id="loading">
	   <iframe MARGINWIDTH=0 MARGINHEIGHT=0 HSPACE=0 VSPACE=0 FRAMEBORDER=0 SCROLLING=no src="loading.html" width="100%"  height="520px">
	  </iframe>
	</div>
	<div class="container hidden" id="album" v-cloak>
		<div class="row mod_data">
			<div class="col-md-4 data__cover">
				<span class="data__cover">
					<img class="img-responsive data__photo" :src="blurPicUrl + '?param=500y500'" />
					<i class="data__cover_mask"></i>
				</span>
			</div>
		<div class="col-md-4 data__cont">
			<div class="row data__row">
				<h1 >
					{{ name }}
					<span v-for="alia in alias" >
						{{ alia }}
					</span>
				</h1>
			</div>
			<div class="row data__row">
				<a :href="toSingerPage(singer.id)">
					<h4>歌手: <span>{{ singer.name }}</h4>
				</a>
			</div>
			<div class="row data__row">
				<h4 >单曲数: <span>{{ size }}</span></h4>
			</div>
		</div>
		</div>
		<div class="row">
			<div class="col-md-2">
				<h3>全部歌曲</h3>
			</div>
		</div>
		<div class="row">
			<div class="col-md-9">
				<table class="table table-hover"> 
					<thead> 
						<tr> 
							<td></td>
							<td>歌曲</td>
							<td>歌手</td>
							<td>时长</td> 
						</tr> 
					</thead > 
					<tbody v-for="(song,index) in songs"> 
						<tr> 
							<td>{{ index+1 }}</td> 
							<td>
								<a :href="toSongPage(song.id)" target="_blank">
									{{ song.name }}
									<span v-if="song.alia.length>0"> ({{ song.alia[0] }})</span>
								</a>
							</td> 
							<td>
								<span v-for="singer in song.ar">
									<a :href="toSingerPage(singer.id)">
										{{ singer.name }}
										<span v-for="alia in singer.alias">{{ alia }}</span>
									</a>
								</span>
								
							</td>
							 <td> {{ formatTime(song.dt) }} </td>
						</tr> 
					</tbody> 
				 </table> 
			</div>
			<div class="col-md-3">
				<h3>专辑简介</h3>
				<p class="web-font">
					{{ description }}
				</p>
			</div>
		</div>
	</div>

    <!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
    <!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
	<script src="js/main.js"></script>
	<script src="js/jquery.base64.js"></script>
  </body>
  <script>
	  //接收一个值
	  function getId(){
	  	var result;
	  	var errors = ['404.html','505.html'];
	  	var url=(window.location.search); //获取url中"?"符后的字串
	  	try{
	  		var decodeUrl = $.base64.decode(url.substring(1));
	  	}catch(e){
	  		window.location.href=errors[Math.floor(Math.random() * errors.length)];
	  	}
	  	if(url.indexOf("?")!=-1){
	  		result = decodeUrl.substr(decodeUrl.indexOf("=")+1);
	  	}
	  	return result;
	  }
	  var albumVue = new Vue({
		  el: '#album',
		  data: {
			id: '',
			name: '',
			description: '', // 歌手简介
			blurPicUrl: '',//歌手图
			alias: [],//别名
			size: '',//歌曲数
			songs: [], //热门歌曲
			publishTime: '',
			singer: {},
		  },
		  methods: {
		  	// 传送至相应的歌手详情页面
		  	toSingerPage: function (id) {
		  		return 'singer.html?' + $.base64.encode('id=' + id);
		  	},
		  	
		  	toSongPage: function (id) {
		  		return 'player.html?' + $.base64.encode('id=' + id);
		  	},
			// 格式化时间
			formatTime: function(time){
				if(time > -1){
					var temp;
					var sec = Math.floor(time/1000);
					//var min = Math.floor(time/60) % 60;
					var min = Math.floor(sec/60);
					sec = sec - min*60;
					if(min < 10){
						temp = "0" + min + ":";
					}else
						temp = min + ":";
					if(sec < 10){
						temp += "0" + sec ;
					}else
						temp += sec ;
				}
				return temp;
			},
			//时间戳转换为日期
			timestampToTime: function(timestamp) {
				var date = new Date(timestamp);//时间戳为10位需*1000，时间戳为13位的话不需乘1000
				var Y = date.getFullYear() ;
				var M = (date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1) ;
				var D = date.getDate() ;
				var h = date.getHours() ;
				if(h < 10)
					h = '0' + h;
				var m = date.getMinutes() ;
				if(m < 10)
					m = '0' + m;
				var s = date.getSeconds();
				return Y + '年' + M + '月' + D + '日';
			}
		    }
	  });
	  $.getJSON(
	      "http://47.96.174.115/album?id=" + getId(),
	      function(data) {
	  	  if(data.code == 200){
			  albumVue.name = data.album.name;
			  albumVue.id = data.album.id;
			  albumVue.description = data.album.description;
			  albumVue.blurPicUrl = data.album.blurPicUrl;
			  albumVue.alias = data.album.alias;
			  albumVue.size = data.album.size;
			  albumVue.songs = data.songs;
			  albumVue.publishTime = data.album.publishTime;
			  albumVue.singer = data.album.artist;
			  document.title = albumVue.name;
			  // 关闭加载动画
			  document.getElementById("loading").setAttribute("class","miaov_head hidden");
			  $("div#album").removeClass("hidden");
	  	  }
	      }
	  );
	  
  </script>
</html>