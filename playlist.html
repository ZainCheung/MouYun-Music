<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
	<link rel="icon" href="img/favicon.ico">
    <title>歌单</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="css/main.css" rel="stylesheet"/>

  </head>
  <body>
	
	<!-- 引入导航栏 -->
	<div class="mod_header">
	    <div class="section_inner">
	        <h1 class="qqmusic_title"><a href="index.html"><img src="img/musiclogo.png" alt="牟云音乐" class="music_logo"></a></h1>
	        <!-- 导航 S -->
	        <ul class="mod_top_nav" role="nav">
	            <li class="top_nav__item">
	                <a href="index.html" class="top_nav__link top_nav__link--current" title="音乐馆">音乐馆</a>
	            </li>
	            <li class="top_nav__item">
	                <a href="playlists.html" class="top_nav__link" title="歌单">歌单</a>
	            </li>
				<li class="top_nav__item">
				    <a href="index.html#ranking" class="top_nav__link" title="排行榜">排行榜</a>
				</li>
				<li class="top_nav__item">
				    <a href="singers.html" class="top_nav__link" title="歌手">歌手</a>
				</li>
	        </ul>
		</div>
	</div>
	<!-- 加载动画 -->
	<div class='miaov_head' id="loading">
	   <iframe MARGINWIDTH=0 MARGINHEIGHT=0 HSPACE=0 VSPACE=0 FRAMEBORDER=0 SCROLLING=no src="loading.html" width="100%"  height="520px">
	  </iframe>
	</div>
	<div id="list" class="container hidden" v-cloak>
		<div class="row mod_data">
		  <div class="col-md-4 data__cover">
			<img class="img-responsive data__photo" :src="coverImgUrl + '?param=400y400'" />  
		  </div>
		<div class="col-md-4 data__cont">
			<div class="row data__row">
				<h2 >{{ name }}</h2>
			</div>
			<div class="row data__row">
				<h4 >标签:
				<span v-for="tag in tags" class="label label-info">
					<a href="#">
						{{ tag }} &nbsp;
					</a>
				</span> 
				</h4>
			</div>
			<div class="row data__row ">
				<span >播放量: <span class="web-font">{{ playCount }}</span></span>
			</div>
			<div class="row data__row">
				<span >歌曲数: <span class="web-font">{{ trackCount }}</span> </span>
			</div>
				<div class="data_play__all">
					<a class="a_play_all" :href="toAllSongPage(id)" >
						<span class="glyphicon glyphicon-play-circle" aria-hidden="true"></span>
						播放全部
					</a>
				</div>
		</div>
		  <div class="col-md-4"></div>
		</div>
		<div class="row">
			<div class="col-sm-9">
				<table class="table table-hover"> 
					<thead> 
						<tr> 
							<td></td>
							<td>歌曲</td>
							<td>歌手</td>
							<td>专辑</td>
							<td>时长</td> 
						</tr> 
					</thead > 
					<tbody v-for="(song,index) in songs"> 
						<tr> 
							<td><span >{{ index+1 }}</span></td> 
							<td>
								<a :href="toSongPage(song.id)" target="_blank">
									<span >{{ song.name }}</span>
									<span v-if="song.alia.length>0" > ({{ song.alia[0] }})</span>
								</a>
							</td> 
							<td> 
								<!-- 遍历出歌手 -->
								<span v-for="(singer,index) in song.ar" >
									<a :href="toSingerPage(singer.id)" target="_blank">
										{{ singer.name }}
									</a>
									
									<!-- 判断是否加入分隔符 -->
									<span v-if="index < song.ar.length-1">/</span>
								</span>
								
							</td>
							 <td><a :href="toAlbumPage(song.al.id)" target="_blank">{{ song.al.name }}</a></td>
							 <td><span >{{ song.dt }}</span>  </td>
						</tr>
					</tbody> 
				 </table> 
			</div>
			<div class="col-md-3">
				<h3>歌单简介</h3>
				<p class="web-font">
					{{ description }}
				</p>
			</div>
		</div>
	</div>

    <!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
    <!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
	<script src="js/jquery.base64.js"></script>
  </body>
  <script>
	  var title;
	  var idString = '';
		//接收一个值
		function oneValues(){
			var result;
			var errors = ['404.html','505.html'];
			var url=(window.location.search); //获取url中"?"符后的字串
			try{
				var decodeUrl = $.base64.decode(url.substring(1));
			}catch(e){
				window.location.href=errors[Math.floor(Math.random() * errors.length)];
			}
			if(url.indexOf("?")!=-1){
				result = decodeUrl.substr(decodeUrl.indexOf("=")+1);
			}
			return result;
		}
		
		//接收多值
		function manyValues(){
			var url=window.location.search;
			if(url.indexOf("?")!=-1){
				var str = url.substr(1);
				strs = str.split("&"); 
				var key=new Array(strs.length);
				var value=new Array(strs.length);
				for(i=0;i<strs.length;i++){
					key[i]=strs[i].split("=")[0]
					value[i]=unescape(strs[i].split("=")[1]); 
					alert(key[i]+"="+value[i]);
				} 
			} 
		}
		// 格式化播放次数
		function formatPlayCount(count){
			if(count >= 100000)
				return (count/10000).toFixed(2) + "万";
			else
				return count;
		}
		// 格式化音乐时长
		function formatDuraton(time){
			if(time > -1){
				var temp;
				var sec = Math.floor(time/1000);
				//var min = Math.floor(time/60) % 60;
				var min = Math.floor(sec/60);
				sec = sec - min*60;
				if(min < 10){
					temp = "0" + min + ":";
				}else
					temp = min + ":";
				if(sec < 10){
					temp += "0" + sec ;
				}else
					temp += sec ;
			}
			return temp;
		};
	 
	  var playlistVue = new Vue({
	  			el: '#list',
	  
	  			data: {
					showloading: true,
	  				id: oneValues(),
	  				coverImgUrl: '',
	  				name: '',
	  				playCount: '',
					trackCount: '',
					description: '',
					singer: {
						id: '',
						name: ''
					},
					song: {
						id:'',//歌曲id
						name: '',//歌名
						ar: [],//歌手数组
						alia: [],//别名
						al: {},//专辑
						dt: '',//时长
						
					},
	  				idLists: [
	  						
	  				],
					songs: [
							
					],
					tags: [
						
					],
					
	  			},
				methods: {
					// 传送至相应的歌手详情页面
					toSingerPage: function (id) {
						return 'singer.html?' +$.base64.encode('id=' + id);
					},
					toAllSongPage: function (id) {
						return 'player.html?' +$.base64.encode('id=' + id + '&type=playlist');
					},
					toSongPage: function (id) {
						return 'player.html?' +$.base64.encode('id=' + id + '&type=song');
					},
					//传送至相应的专辑详情页面
					toAlbumPage: function (id) {
						return 'album.html?' +$.base64.encode('id=' + id);
					},
				  }
	  });
	  $.getJSON(
	      "http://47.96.174.115/playlist/detail?id=" + oneValues(),
			function(data) {
				if(data.code == 200){
					playlistVue.coverImgUrl = data.playlist.coverImgUrl;//歌单图片
					playlistVue.name = data.playlist.name;//歌单名
					playlistVue.playCount = formatPlayCount(data.playlist.playCount);//歌单播放次数
					playlistVue.trackCount = data.playlist.trackCount;//歌单歌曲数量
					playlistVue.description = data.playlist.description;//歌单描述
					for(var i=0;i<data.playlist.tags.length;i++){
						playlistVue.tags.push(data.playlist.tags[i]);//歌单标签
					}
					for(var i=0;i<data.playlist.trackIds.length;i++){
						// 向推荐歌单数组里遍历添加歌单
						playlistVue.idLists.push(
							data.playlist.trackIds[i].id
							);
						// 将歌曲的id拼装成接口参数字符串
						if(i<data.playlist.trackIds.length-1)
							idString += playlistVue.idLists[i] + ",";
						else
							idString += playlistVue.idLists[i];
					}
					document.title = playlistVue.name;
					$.getJSON(
							"http://47.96.174.115/song/detail?ids="+ idString,
							function(data) {
								console.log(data);
								for(var j=0;j<data.songs.length;j++){
									playlistVue.songs.push({
										id:data.songs[j].id, //歌曲id
										name:data.songs[j].name, //歌曲名
										ar: data.songs[j].ar, //歌手
										alia:data.songs[j].alia, //别名
										al: data.songs[j].al, //专辑
										dt: formatDuraton(data.songs[j].dt), //时长
									});
								}
							}
					);
					document.getElementById("loading").setAttribute("class","miaov_head hidden");
					$("div#list").removeClass("hidden");
				}
	      }
	  );
	
  </script>
</html>